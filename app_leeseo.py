import httpx
import os
import streamlit as st
from openai import OpenAI


# ----------------------------------------------------------------------
# 1. API í‚¤ ë¡œë“œ ë° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” 
# ----------------------------------------------------------------------
# --- API í‚¤ ì„¤ì • (Secrets ì‚¬ìš©) ---
# ì—ëŸ¬ ë°©ì§€ë¥¼ ìœ„í•œ ì•ˆì „í•œ í‚¤ ê°€ì ¸ì˜¤ê¸° ë¡œì§
# 1. Secretsì— 'OPENAI_API_KEY'ê°€ ìˆëŠ”ì§€ í™•ì¸
if "OPENAI_API_KEY" in st.secrets:
    api_key = st.secrets["OPENAI_API_KEY"]
    client = OpenAI(api_key=api_key)
# 2. í˜¹ì‹œ ì‚¬ìš©ìê°€ 'API_KEY'ë¼ê³  ì €ì¥í–ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„ (í˜¸í™˜ì„±)
elif "API_KEY" in st.secrets:
    api_key = st.secrets["API_KEY"]
    client = OpenAI(api_key=api_key)
else:
    # í‚¤ê°€ ì•„ì˜ˆ ì—†ì„ ê²½ìš° ì—ëŸ¬ ë©”ì‹œì§€
    st.error("ğŸš¨ API í‚¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Streamlit Secretsì— 'OPENAI_API_KEY'ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.")
    st.stop()

# ----------------------------------------------------------------------
# 2. Streamlit ì•± ë ˆì´ì•„ì›ƒ
# ----------------------------------------------------------------------
st.set_page_config(
    page_title="í•™ìƒíšŒ í†µí•© í”Œë«í¼",
    page_icon="ğŸ“",
    layout="wide"
)

st.title("ğŸ“ í•™ìƒíšŒ í†µí•© í”Œë«í¼")
st.write("í•™ìƒíšŒ ì„ì›ê³¼ í•™ìƒ ê°„ì˜ ëª¨ë“  ì†Œí†µê³¼ ì—…ë¬´ë¥¼ AI ê¸°ë°˜ìœ¼ë¡œ ìë™í™”í•˜ëŠ” í†µí•© í”Œë«í¼ì…ë‹ˆë‹¤.")

st.markdown("""
 ğŸ“Œ ê¸°ëŠ¥ ì„¤ëª…
- ê³µì§€ ì¼ì • í†µí•© ê´€ë¦¬  
- ê³µì§€ë¬¸ ìë™ ì‘ì„±  
- íšŒì˜ë¡ ìë™ ìš”ì•½  
- ì„¤ë¬¸ ì‘ë‹µ ë¶„ì„  
- ìµëª… ì˜ê²¬ ìˆ˜ì§‘  
- ì—…ë¬´ ì¸ìˆ˜ì¸ê³„ ìë™í™”  
---
""")

# ì‚¬ìš©ì ì…ë ¥
user_msg = st.text_input("ğŸ“¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”:")

# ----------------------------------------------------------------------
# 3. ë‹µë³€ ë¡œì§ (ë²„íŠ¼ ì•ˆì— ëª¨ë“  API í˜¸ì¶œ ë° ì¶œë ¥ í¬í•¨)
# ----------------------------------------------------------------------
if st.button("ë‹µë³€ í™•ì¸í•˜ê¸°"):
    if not user_msg:
        st.warning("ì…ë ¥í•  ë‚´ìš©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.")
    else:
        with st.spinner("ì²˜ë¦¬ ì¤‘..."):
            try:
                chat_completion = client.chat.completions.create(
                    messages=[
                        {
                            "role": "user",
                            "content": user_msg,
                        },
                        {
                            "role": "system",
                            "content": "ë„ˆëŠ” í•™ìƒíšŒ í†µí•© í”Œë«í¼ì˜ ë‚´ë¶€ ê¸°ëŠ¥ìœ¼ë¡œì„œ ì‚¬ìš©ì ìš”ì²­ì„ ìì—°ìŠ¤ëŸ½ê³  ì •í™•í•˜ê²Œ ì²˜ë¦¬í•´ì£¼ëŠ” ì§€ì› ë„ìš°ë¯¸ì•¼. ë„ˆ ìì‹ ì„ AIë¼ê³  ì†Œê°œí•˜ê±°ë‚˜ AIë¼ëŠ” ë§ì„ ì‚¬ìš©í•˜ì§€ ë§ê³ , ë‹¨ìˆœíˆ ì‹œìŠ¤í…œ ê¸°ëŠ¥ì²˜ëŸ¼ ì‘ë‹µí•´ë¼.",
                        }
                    ],
                    model="gpt-4o"
                )
                
                # chat_completion ì •ì˜ í›„ ë°”ë¡œ result ì •ì˜ ë° ì¶œë ¥
                result = chat_completion.choices[0].message.content
                st.write(result)
            
            except Exception as e:

                st.error(f"API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

